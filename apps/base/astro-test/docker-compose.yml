services:
    postgres_db:
        image: postgres:17.6-alpine3.21
        restart: always
        container_name: database_db
        environment:
            POSTGRES_USER: ${DB_USER}
            POSTGRES_PASSWORD: ${DB_PASS}
            POSTGRES_DB: ${DB_NAME}
        volumes:
            - postgres_data:/var/lib/postgresql/data
        ports:
            - "${DB_PORT}:5432"
        networks:
            - dokploy-network
    app:
        container_name: template_app
        build:
            context: .
            dockerfile: Dockerfile
            target: development
        ports:
            - "${PORT}:${PORT}"
        environment:
            PUBLIC_APP_NAME: ${PUBLIC_APP_NAME}
            NODE_ENV: ${NODE_ENV}
            PUBLIC_ENV: ${PUBLIC_ENV}
            PORT: ${PORT}
            PUBLIC_URL: ${PUBLIC_URL}
            PUBLIC_PORT: ${PUBLIC_PORT}
            DB_HOST: ${DB_HOST}
            DB_PORT: ${DB_PORT}
            DB_USER: ${DB_USER}
            DB_PASS: ${DB_PASS}
            DB_NAME: ${DB_NAME}
            DATABASE_URL: ${DATABASE_URL}
            MINIO_ROOT_USER: ${MINIO_ROOT_USER}
            MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
            MINIO_BUCKET_NAME: ${MINIO_BUCKET_NAME}
            MAIL_HOST: ${MAIL_HOST}
            MAIL_PORT: ${MAIL_PORT}
            JWT_KEY: ${JWT_KEY}
            PUBLIC_HMAC_KEY: ${PUBLIC_HMAC_KEY}
            PUBLIC_PLUBIC_VAPID_EMAIL: ${PUBLIC_PLUBIC_VAPID_EMAIL}
            PUBLIC_PRIVATE_VAPID_KEY: ${PUBLIC_PRIVATE_VAPID_KEY}
            CHOKIDAR_USEPOLLING: true
            CHOKIDAR_INTERVAL: 250
        depends_on:
            - postgres_db
        restart: always
        volumes:
            - ./:/usr/src/app
            - ./src/assets/temp:/usr/src/app/src/assets/temp
            - /usr/src/app/node_modules
        networks:
            - dokploy-network

volumes:
    postgres_data:
networks:
    dokploy-network:
        external: true
