version: "3.8"

# Plantilla com√∫n para todos los nodos MinIO
x-minio-common: &minio-common
  image: minio/minio:RELEASE.2025-09-07T16-13-09Z
  command: server http://minio{1...4}/data{1...2} --console-address ":9001"  # server http://minio{1...4}/data{1...2} http://minio{5...8}/data{1...2} si agregas 4 mas 
  volumes:
    - /mnt/disk1:/data1
    - /mnt/disk2:/data2
  networks:
    - minio-net
    - dokploy-network
  environment:
    MINIO_ROOT_USER: ${MINIO_ROOT_USER}
    MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
  deploy:
    replicas: 1
    restart_policy:
      condition: on-failure

services:
  minio1:
    <<: *minio-common
    hostname: minio1
    deploy:
      resources:
        limits:
          cpus: "3"
          memory: 3G
        reservations:
          cpus: "0.5"
          memory: 1G
      placement:
        constraints:
          - node.labels.minio-node == 1

  minio2:
    <<: *minio-common
    hostname: minio2
    deploy:
      resources:
        limits:
          cpus: "3"
          memory: 3G
        reservations:
          cpus: "0.5"
          memory: 1G
      placement:
        constraints:
          - node.labels.minio-node == 2

  minio3:
    <<: *minio-common
    hostname: minio3
    deploy:
      resources:
        limits:
          cpus: "3"
          memory: 3G
        reservations:
          cpus: "0.5"
          memory: 1G
      placement:
        constraints:
          - node.labels.minio-node == 3

  minio4:
    <<: *minio-common
    hostname: minio4
    deploy:
      resources:
        limits:
          cpus: "3"
          memory: 3G
        reservations:
          cpus: "0.5"
          memory: 1G
      placement:
        constraints:
          - node.labels.minio-node == 4

networks:
  minio-net:
    driver: overlay
    attachable: true
  dokploy-network:
    external: true
